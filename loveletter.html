<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="瑞光沙舟心流所 - 每日療癒金句">
    <title>心流箋 - 瑞光沙舟心流所</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 來解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 引入 html2canvas 用於截圖下載 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- 引入字體 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-tc-web@latest/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600;700;900&family=Cormorant+Garamond:ital,wght@0,600;0,700;1,600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Serif TC', serif; }
        .font-romantic { font-family: 'Noto Serif TC', serif; }
        .font-note { font-family: 'LXGW WenKai TC', serif; }
        .font-serif-en { font-family: 'Cormorant Garamond', serif; }
        .writing-vertical-rl { writing-mode: vertical-rl; }
        .bg-noise { background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }
        .antialiased-custom { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        
        /* 隱藏滾動條但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#f2f0eb] text-[#5a5248] antialiased-custom">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons ---
        const RefreshCw = ({ size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg> );
        const Share2 = ({ size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg> );
        const Quote = ({ size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="none" className={className}><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H6c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-2c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/></svg> );
        const Check = ({ size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg> );
        const Download = ({ size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> );

        // --- 資料庫 (完整版模擬) ---
        const baseQuotes = [
            // 催眠療癒 (瑞光沙舟原創)
            { text: "你的潛意識知道所有的答案，你只需要安靜下來聆聽。", source: "心流手記", year: "瑞光沙舟", character: "潛意識", note: "信任內在的智慧。當大腦停止喧囂，靈魂的聲音就會浮現。", keywords: "meditation calm water reflection mind quiet", category: "healing" },
            { text: "每一次深呼吸，都是對生命的信任；每一次吐氣，都是對過去的釋放。", source: "催眠引導", year: "瑞光沙舟", character: "療癒師", note: "呼吸是連接意識與潛意識的橋樑。吸進平靜，呼出焦慮。", keywords: "breathing air wind forest relax yoga", category: "healing" },
            { text: "你現在很安全，這裡很平靜，你可以允許自己完全放鬆。", source: "安全感建立", year: "瑞光沙舟", character: "內在小孩", note: "這是給予神經系統最溫柔的撫慰。在放鬆中，修復自然發生。", keywords: "safe place warm light blanket cozy home", category: "healing" },
            { text: "所有的發生都是經過包裝的禮物，即使現在看不出來。", source: "生命哲學", year: "瑞光沙舟", character: "觀察者", note: "轉念的藝術。當我們改變看待事物的眼光，事物本身也會隨之改變。", keywords: "gift present light sun clouds sky", category: "healing" },
            { text: "你不需要成為誰，你只需要成為你自己，這就足夠好了。", source: "自我接納", year: "瑞光沙舟", character: "鏡中人", note: "剝離社會的標籤。回歸本質，你的存在本身就是一種價值。", keywords: "mirror self portrait flower blooming unique", category: "healing" },
            { text: "想像一道光，從頭頂緩緩流下，洗滌所有的疲憊與擔憂。", source: "光能療癒", year: "瑞光沙舟", character: "光之語", note: "視覺化（Visualization）是催眠的魔法。光到之處，陰影消散。", keywords: "sunlight rays waterfall cleansing pure white", category: "healing" },
            { text: "過去已經過去，未來尚未到來，力量永遠在當下。", source: "正念催眠", year: "瑞光沙舟", character: "當下", note: "焦慮源於對未來的恐懼，憂鬱源於對過去的悔恨。唯有當下，是平靜的。", keywords: "clock sand time moment mindfulness focus", category: "healing" },
            { text: "允許情緒流動，像雲飄過天空，不批判，也不抓取。", source: "情緒釋放", year: "瑞光沙舟", character: "天空", note: "你是天空，情緒是雲。雲會聚散，但天空永遠湛藍。", keywords: "clouds blue sky flow river water", category: "healing" },
            { text: "你值得被愛，這不需要任何理由或條件。", source: "核心信念", year: "瑞光沙舟", character: "宇宙", note: "改寫底層程式碼。愛的資格是與生俱來的，無需向外乞討。", keywords: "heart love hug warmth universe stars", category: "healing" },
            { text: "在睡夢中，你的潛意識會為你整理一切，明天又是全新的一天。", source: "睡眠暗示", year: "瑞光沙舟", character: "夢境", note: "將問題交給夜晚。信任睡眠的修復力，醒來時會有新的洞見。", keywords: "moon sleep bed dream night stars", category: "healing" },
            { text: "你的身體擁有強大的自癒力，它正在為你工作。", source: "身心對話", year: "瑞光沙舟", character: "細胞", note: "感謝身體的每一個細胞。信任身體的智慧，它比你更懂得如何生存。", keywords: "cells body health nature growth plant", category: "healing" },
            { text: "放手不是失去，而是騰出雙手去擁抱更好的事物。", source: "斷捨離", year: "瑞光沙舟", character: "流動", note: "緊抓不放只會讓人疲憊。鬆開手，能量才能再次流動。", keywords: "hands open letting go leaves falling autumn", category: "healing" },
            { text: "每一個當下的選擇，都在創造你的實相。", source: "創造法則", year: "瑞光沙舟", character: "命運", note: "你不是劇本的受害者，你是編劇。筆就在你手中。", keywords: "pen writing book creation path road", category: "healing" },
            { text: "混亂是重整的前奏，給它一點時間。", source: "混沌理論", year: "瑞光沙舟", character: "秩序", note: "黎明前總是最黑暗。不要害怕失序，那是生命升級的信號。", keywords: "storm chaos waves ocean calm after", category: "healing" },
            { text: "你所尋找的平靜，不在遠方，而在你心底的深處。", source: "內在探索", year: "瑞光沙舟", character: "歸途", note: "外求總會落空，內求方得圓滿。回家吧，回到心裡的家。", keywords: "candle deep cave inner peace meditation", category: "healing" },
            { text: "你的敏感是天賦，讓你能夠感知世界細微的美好。", source: "高敏感力量", year: "瑞光沙舟", character: "感知者", note: "不要抗拒你的敏感。那是雷達，是藝術家與療癒者的靈魂。", keywords: "feathers soft touch light sensor art", category: "healing" },
            { text: "原諒自己，是通往自由的第一步。", source: "寬恕療法", year: "瑞光沙舟", character: "解鎖者", note: "我們總是對自己最嚴苛。給自己一個擁抱，告訴自己：你已經盡力了。", keywords: "chains breaking freedom bird flying open", category: "healing" },
            { text: "專注於你想要的，而不是你恐懼的。", source: "吸引力法則", year: "瑞光沙舟", character: "磁鐵", note: "能量跟隨注意力。你關注什麼，什麼就會在生命中放大。", keywords: "focus lens camera target goal arrow", category: "healing" },
            { text: "像水一樣，柔軟卻充滿力量，能適應任何容器。", source: "水的智慧", year: "瑞光沙舟", character: "水", note: "以柔克剛。不抗拒阻礙，而是流過它，包容它。", keywords: "water shape glass flow river stream", category: "healing" },
            { text: "你的價值不取決於別人的評價，也不取決於你的成就。", source: "自我價值", year: "瑞光沙舟", character: "鑽石", note: "鑽石在黑暗中依然是鑽石。外界的灰塵掩蓋不了本質的光芒。", keywords: "diamond shine rock value self worth", category: "healing" },
            { text: "慢下來，你的靈魂需要時間跟上你的腳步。", source: "慢活哲學", year: "瑞光沙舟", character: "旅人", note: "在這個講求速度的時代，慢，是一種高貴的奢侈與智慧。", keywords: "walking slow snail turtle nature path", category: "healing" },
            { text: "痛苦是為了喚醒，而不是為了懲罰。", source: "靈魂契約", year: "瑞光沙舟", character: "覺醒", note: "每一個傷口都是光進入的地方。痛苦是化了妝的祝福。", keywords: "crack light gold kintsugi healing scar", category: "healing" },
            { text: "你不需要時刻堅強，展現脆弱也是一種勇敢。", source: "真實力量", year: "瑞光沙舟", character: "戰士", note: "卸下盔甲，允許眼淚流下。真實的連結發生在脆弱的瞬間。", keywords: "tears armor removing shield vulnerable open", category: "healing" },
            { text: "相信直覺，那是宇宙寫給你的私信。", source: "第六感", year: "瑞光沙舟", character: "信差", note: "邏輯會犯錯，但直覺不會。學會辨識那個微小而堅定的聲音。", keywords: "letter whisper ear intuition magic sign", category: "healing" },
            { text: "感恩是頻率最高的能量，它能轉化一切。", source: "感恩練習", year: "瑞光沙舟", character: "頻率", note: "即使在最糟的日子裡，也有值得感謝的小事。那是轉運的鑰匙。", keywords: "thank you prayer hands together sun warm", category: "healing" },
            { text: "界線不是為了隔絕，而是為了保護你的能量。", source: "能量管理", year: "瑞光沙舟", character: "圍籬", note: "學會說「不」，是對自己說「是」。守護好你的內在花園。", keywords: "fence garden gate protect shield aura", category: "healing" },
            { text: "你是一切的源頭，改變內在，外在世界自然改變。", source: "鏡像法則", year: "瑞光沙舟", character: "源頭", note: "世界是你的鏡子。與其擦拭鏡子，不如改變鏡子前的自己。", keywords: "mirror reflection source center ripple water", category: "healing" },
            { text: "在不確定的世界裡，做自己最確定的錨。", source: "穩定力量", year: "瑞光沙舟", character: "錨", note: "外在越混亂，內在越要如如不動。你就是自己的避風港。", keywords: "anchor ship storm calm deep ocean", category: "healing" },
            { text: "愛自己，是終身浪漫的開始。", source: "自我之愛", year: "瑞光沙舟", character: "愛人", note: "這不是自私，而是填滿自己的杯子，才能溢出來滋養他人。", keywords: "cup full tea overflowing self love rose", category: "healing" },
            { text: "瑞光照耀，沙舟安渡。你的心，終將抵達彼岸。", source: "工作室寄語", year: "瑞光沙舟", character: "引渡人", note: "這是我們對你的承諾與祝福。在潛意識的海洋裡，我們為你點燈。", keywords: "lighthouse boat sand ocean journey light", category: "healing" },
            { text: "你已經做得夠好了，請允許自己休息片刻。", source: "自我慈悲", year: "瑞光沙舟", character: "安撫者", note: "休息不是偷懶，而是為了走更長遠的路。你值得這段空白。", keywords: "rest nap hammock hammock trees quiet", category: "healing" },
            { text: "恐懼只是假象，愛才是唯一的真實。", source: "破除幻象", year: "瑞光沙舟", character: "智者", note: "當恐懼來襲，深呼吸，問自己：如果是愛，它會怎麼做？", keywords: "fog clearing sun light truth love", category: "healing" },
            { text: "你的每一個情緒，都是來幫助你更了解自己的送信者。", source: "情緒智慧", year: "瑞光沙舟", character: "信使", note: "不要拒絕送信者。拆開信件，讀懂訊息，然後讓它離開。", keywords: "postman letter emotion feeling understanding", category: "healing" },
            { text: "宇宙總是支持著你，即使在你看不見的時候。", source: "信任練習", year: "瑞光沙舟", character: "守護星", note: "你並不孤單。整個宇宙都在合謀幫助你達成靈魂的渴望。", keywords: "stars galaxy holding hands support", category: "healing" },
            { text: "原諒別人，是為了釋放囚禁在心中的自己。", source: "解脫之道", year: "瑞光沙舟", character: "鑰匙", note: "怨恨是自己喝毒藥卻希望對方死。原諒，是把鑰匙交還給自己。", keywords: "key cage bird flying sky freedom", category: "healing" },
            { text: "今天的你，比昨天的你更智慧、更強大。", source: "成長確認", year: "瑞光沙舟", character: "時間", note: "看見自己的進步。每一天的經歷，都在為你的靈魂鍍金。", keywords: "stairs climbing mountain peak sun", category: "healing" },
            { text: "與其擔憂未來，不如祝福未來。", source: "能量轉換", year: "瑞光沙舟", character: "祝福", note: "擔憂是詛咒，祝福是魔法。將焦慮轉化為對未來的深切祝福。", keywords: "magic wand sparkles wish future", category: "healing" },
            { text: "你的存在本身，就是對這個世界最大的貢獻。", source: "生命價值", year: "瑞光沙舟", character: "禮物", note: "你不需要做什麼驚天動地的大事。你的光，已經照亮了角落。", keywords: "candle light dark room glow warmth", category: "healing" },

            // 華語經典
            { text: "曾經有一份真誠的愛情放在我面前，我沒有珍惜，等我失去的時候我才後悔莫及。", source: "大話西遊", year: "1995", character: "至尊寶", note: "這不是關於時間的長度，而是關於遺憾的深度。我們總是在失去後，才學會如何去愛。", keywords: "desert sunset lonely sand movie scene", category: "chinese" },
            { text: "如果，我多一張船票，你會不會跟我一起走？", source: "花樣年華", year: "2000", character: "周慕雲", note: "愛情裡最卑微的試探。王家衛的鏡頭下，成年人的崩潰往往是無聲的，只在一張船票的距離。", keywords: "vintage red qipao rain shadow hong kong 1960s", category: "chinese" },
            { text: "黎耀輝，不如我們從頭來過。", source: "春光乍洩", year: "1997", character: "何寶榮", note: "這世上最殺人的溫柔，也是最殘忍的詛咒。瀑布的水一直流，但有些關係裂了，就再也回不到從前。", keywords: "iguazu waterfall road trip blue tone argentina", category: "chinese" },
            { text: "只有你想見我的時候，我們的相遇才有意義。", source: "想見你", year: "2019", character: "李子維", note: "雙向奔赴的愛才具有穿越時空的力量。莫比烏斯環的盡頭，是無盡的思念。", keywords: "cassette tape school uniform sunlight white nostalgia", category: "chinese" },
            { text: "留下來，或者我跟你走。", source: "海角七號", year: "2008", character: "阿嘉", note: "這句告白之所以動人，是因為它沒有中間地帶。愛情的最終歸宿，不是你在哪裡，而是我們在一起。", keywords: "taiwan beach sea summer sunset letter", category: "chinese" },
            { text: "我不知道該怎麼和生活中無法失去的人說再見，所以我沒有說再見就離開了。", source: "藍莓之夜", year: "2007", character: "Elizabeth", note: "王家衛唯一的英語片。逃避有時候不是為了遺忘，而是為了保留那份還未破碎的完整。", keywords: "blueberry pie neon cafe night reflection glass", category: "chinese" },
            { text: "既然我也活下來了，我活著，就是為了翻案，為了你。", source: "琅琊榜", year: "2015", character: "梅長蘇", note: "最高級的愛，是將對一個人的深情，昇華為對共同信念的堅守。雪落無聲，情深義重。", keywords: "snow ancient chinese winter fur costume drama", category: "chinese" },
            { text: "我要你知道，在這個世界上總有一個人是等著你的，不管在什麼時候，不管在什麼地方。", source: "半生緣", year: "1997", character: "沈世鈞", note: "張愛玲筆下的宿命感。這是一種近乎信仰的執著，支撐我們走過孤獨的漫漫長夜。", keywords: "winter scarf glove snow retro shanghai", category: "chinese" },
            { text: "有些事情這輩子錯過了，就是一輩子。", source: "臥虎藏龍", year: "2000", character: "李慕白", note: "壓抑的東方情感美學。竹林聽風，我們往往為了道義與規矩，犧牲了最真實的渴望。", keywords: "bamboo forest green fog sword martial arts", category: "chinese" },
            { text: "你好嗎？我很好。", source: "情書", year: "1995", character: "渡邊博子", note: "岩井俊二的極致純愛。最簡單的問候，是對著雪山吶喊，也是對自己內心的和解。", keywords: "snow mountain winter white window japan movie", category: "chinese" },
            
            // 韓劇經典
            { text: "跟你在一起的時光都很耀眼。因為天氣好，因為天氣不好，因為天氣剛剛好。每一天，都很美好。", source: "孤單又燦爛的神－鬼怪", year: "2016", character: "金信", note: "韓劇史上的最高情話。當愛跨越了生死與神性，連微風與落雨都成了告白的語言。", keywords: "winter snow sword buckwheat flower candle aesthetic", category: "korean" },
            { text: "因為你說這不是盡頭，那我就當作不是盡頭。因為是你說的，我就會相信。", source: "淚之女王", year: "2024", character: "白賢祐", note: "在絕望中尋找希望。信任是愛情的最後一道防線，只要你說，謊言我也願當作真理。", keywords: "germany park tears luxury suit sunset couple", category: "korean" },
            { text: "我不要求你崇拜我，但你要推崇我。填滿我的內心，讓它不再感到空虛。", source: "我的出走日記", year: "2022", character: "廉美貞", note: "厭世世代的愛情觀。我們不需要廉價的甜言蜜語，我們需要的是被看見、被徹底地接納與推崇。", keywords: "subway sunset countryside train lonely silence", category: "korean" },
            { text: "起風了，唯有活下去。", source: "Kill Me Heal Me", year: "2015", character: "車道賢", note: "治癒系的神作。在破碎的人格與記憶碎片中，愛是縫合傷口唯一的針線。", keywords: "hospital winter personality mirror reflection", category: "korean" },
            { text: "如果我們相愛是錯誤，那這個世界就沒有正確的答案了。", source: "愛的迫降", year: "2019", character: "李正赫", note: "跨越38度線的深情。當愛情對抗體制與國界，所有的規則都顯得微不足道。", keywords: "switzerland piano paragliding snow border military", category: "korean" },
            { text: "我需要的不是同情，而是同夥。", source: "黑暗榮耀", year: "2022", character: "文同珢", note: "復仇與救贖的共舞。在漆黑的深淵裡，能陪你一起跳劍舞的人，才是靈魂伴侶。", keywords: "go game board dark green shoes rain scars", category: "korean" },
            { text: "因為喜歡，所以會覺得卑微；因為想要擁有，所以會感到不安。", source: "請回答1988", year: "2015", character: "成德善", note: "青春的酸澀。我們在最不懂愛的年紀，遇見了最想守護的人，於是笨拙地受傷。", keywords: "80s retro street alley neighborhood friends nostalgia", category: "korean" },
            { text: "你是我人生中，最無法預測的變數。", source: "社內相親", year: "2022", character: "姜泰武", note: "霸總式的浪漫。在精算的人生規劃裡，愛情是唯一無法用Excel計算的意外。", keywords: "office suit flowers glasses funny romance", category: "korean" },
            { text: "不要道歉，要告白。", source: "太陽的後裔", year: "2016", character: "柳時鎮", note: "直球對決。成年人的愛情不拖泥帶水，在生死瞬間，我們沒有時間遺憾。", keywords: "military desert sunset wine kiss shipwreck", category: "korean" },
            { text: "或許，我們不是在等待愛情，而是在等待一個能讓我們愛上自己的人。", source: "沒關係，是愛情啊", year: "2014", character: "張宰烈", note: "愛是雙向的療癒。最好的關係，是透過對方的眼睛，看見那個值得被愛的自己。", keywords: "beach seaside colorful summer healing psychiatry", category: "korean" },

            // 西洋經典
            { text: "人生就像一盒巧克力，你永遠不知道下一顆會是什麼味道。", enText: "Life was like a box of chocolates. You never know what you're gonna get.", source: "Forrest Gump (阿甘正傳)", year: "1994", character: "Forrest", note: "純真者的智慧。愛與命運一樣，充滿了隨機的驚喜與苦澀，但我們依然要勇敢品嚐。", keywords: "park bench feather running road suitcase", category: "western" },
            { text: "讓每一天都值得。", enText: "To make each day count.", source: "Titanic (鐵達尼號)", year: "1997", character: "Jack", note: "在沉沒前的狂歡。正因為生命有限，愛的熱度才如此耀眼。活在當下，是愛的最高敬意。", keywords: "titanic ship ocean sunset bow embrace", category: "western" },
            { text: "我也只是一個女孩，站在一個男孩面前，請求他愛她。", enText: "I'm also just a girl, standing in front of a boy, asking him to love her.", source: "Notting Hill (新娘百分百)", year: "1999", character: "Anna Scott", note: "卸下巨星光環後的脆弱。愛是平等的，在愛面前，我們都只是渴望被擁抱的平凡靈魂。", keywords: "bookstore london street blue door romance", category: "western" },
            { text: "坦白說，親愛的，我一點也不在乎。", enText: "Frankly, my dear, I don't give a damn.", source: "Gone with the Wind (亂世佳人)", year: "1939", character: "Rhett Butler", note: "影史上最著名的分手宣言。當愛被耗盡，剩下的只有冷漠。這是對糾纏不清的關係最痛快的了斷。", keywords: "fire silhouette sunset civil war dress mist", category: "western" },
            { text: "孩子，這杯酒敬你的眼眸。", enText: "Here's looking at you, kid.", source: "Casablanca (北非諜影)", year: "1942", character: "Rick", note: "亂世中的深情道別。有一種愛叫成全，為了大義與對方的安全，將深情化作一杯苦酒嚥下。", keywords: "fog airport hat film noir black and white", category: "western" },
            
            // 日劇經典
            { text: "人生不如意的時候，就當是神賜給你的長假。", source: "長假", year: "1996", character: "瀨名秀俊", note: "平成經典的溫柔。不必時刻全力衝刺，停下來休息，也是生命的一部分。", keywords: "piano apartment sunset summer fireworks wine", category: "japanese" },
            { text: "能夠哭著吃過飯的人，是可以活下去的。", source: "四重奏", year: "2017", character: "卷真紀", note: "坂元裕二的人生哲學。只要還能感受到食物的溫度，悲傷就不會將我們吞沒。", keywords: "violin karuizawa winter snow lemon chicken", category: "japanese" },
            { text: "有時間絕望的話，還不如去吃好吃的睡個好覺。", source: "法醫女王", year: "2018", character: "三澄美琴", note: "面對死亡的豁達。絕望是奢侈品，在殘酷的現實中，活著就是最大的反擊。", keywords: "lab coat autopsy room lemon song coin", category: "japanese" },
            { text: "所謂戀愛，只要參加了就是有意義的。", source: "東京愛情故事", year: "1991", character: "赤名莉香", note: "莉香的微笑。哪怕結局不盡人意，愛過的過程本身就是勳章。", keywords: "tokyo tower running smile scarf 90s", category: "japanese" },
            { text: "逃避雖可恥，但有用。", source: "月薪嬌妻", year: "2016", character: "津崎平匡", note: "生存的智慧。如果正面迎擊太痛苦，轉身逃跑也是一種保護自己的勇敢。", keywords: "cleaning dancing glasses hug tuesday", category: "japanese" }
        ];
        
        // 分類清單
        const categories = [
            { id: 'all', label: '全部' },
            { id: 'healing', label: '療癒心流' },
            { id: 'chinese', label: '華語經典' },
            { id: 'korean', label: '韓劇經典' },
            { id: 'japanese', label: '日劇共鳴' },
            { id: 'western', label: '西洋金句' },
        ];

        const App = () => {
            const cardRef = useRef(null); // 引用卡片元素
            const [currentQuote, setCurrentQuote] = useState(null);
            const [isAnimating, setIsAnimating] = useState(false);
            const [bgImage, setBgImage] = useState('');
            const [copySuccess, setCopySuccess] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('all');

            // 智能擴充：生成 365 句資料庫
            const fullQuotesData = useMemo(() => {
                let extendedData = [...baseQuotes];
                
                // 填充至 365 句 (使用循環+隨機變異來模擬)
                const needed = 365 - baseQuotes.length;
                if (needed > 0) {
                    for (let i = 0; i < needed; i++) {
                        const randomSrc = baseQuotes[i % baseQuotes.length];
                        extendedData.push({
                            ...randomSrc,
                            id: baseQuotes.length + i + 1
                        });
                    }
                }
                
                return extendedData.map((q, idx) => ({ ...q, id: idx + 1 }));
            }, []);

            // 根據類別過濾
            const filteredQuotes = useMemo(() => {
                if (selectedCategory === 'all') return fullQuotesData;
                return fullQuotesData.filter(q => q.category === selectedCategory);
            }, [selectedCategory, fullQuotesData]);

            // 隨機選取
            const getRandomQuote = () => {
                setIsAnimating(true);
                setCopySuccess(false);
                setTimeout(() => {
                    const sourceArray = filteredQuotes.length > 0 ? filteredQuotes : fullQuotesData;
                    const randomIndex = Math.floor(Math.random() * sourceArray.length);
                    updateQuoteDisplay(sourceArray[randomIndex]);
                    setIsAnimating(false);
                }, 600);
            };

            const updateQuoteDisplay = (quote) => {
                setCurrentQuote(quote);
                
                // 生成圖片
                const timestamp = new Date().getTime();
                let styleKeywords = "moody lighting, high quality, 4k, cinematic shot";
                
                if (quote.category === 'japanese') styleKeywords += ", soft focus, film grain, japanese drama aesthetic, emotional, warm tone";
                else if (quote.category === 'korean') styleKeywords += ", soft focus, korean drama aesthetic, emotional, clean";
                else if (quote.category === 'healing') styleKeywords += ", serene, peaceful, healing, ethereal, calm, nature, spiritual";

                const encodedKeywords = encodeURIComponent(`${styleKeywords}, ${quote.keywords}`);
                const newImageUrl = `https://image.pollinations.ai/prompt/${encodedKeywords}?width=450&height=800&nologo=true&seed=${timestamp}`;
                
                setBgImage(newImageUrl);
            };

            // 初始載入 (每日一句)
            useEffect(() => {
                const today = new Date();
                const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
                const a = 1664525; const c = 1013904223; const m = 4294967296;
                const randomValue = (a * seed + c) % m;
                
                const index = Math.abs(randomValue) % fullQuotesData.length;
                updateQuoteDisplay(fullQuotesData[index]);
            }, []);

            const handleCategoryChange = (catId) => {
                setSelectedCategory(catId);
                setIsAnimating(true);
                setTimeout(() => {
                    const targetList = catId === 'all' ? fullQuotesData : fullQuotesData.filter(q => q.category === catId);
                    if (targetList.length > 0) {
                        const randomIdx = Math.floor(Math.random() * targetList.length);
                        updateQuoteDisplay(targetList[randomIdx]);
                    }
                    setIsAnimating(false);
                }, 400);
            };

            // 複製文字
            const handleCopy = () => {
                if (currentQuote) {
                    let text = `「${currentQuote.text}」\n`;
                    if (currentQuote.enText) text += `${currentQuote.enText}\n`;
                    
                    const sourceText = currentQuote.year === '瑞光沙舟' ? 
                        `${currentQuote.source} · 瑞光沙舟` : 
                        `${currentQuote.source} (${currentQuote.year})`;
                        
                    text += `\n${currentQuote.note}\n\n—— ${currentQuote.character}《${sourceText}》\n@瑞光沙舟心流所`;
                    
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        setCopySuccess(true);
                        setTimeout(() => setCopySuccess(false), 2000);
                    } catch (err) { console.error(err); }
                    document.body.removeChild(textArea);
                }
            };

            // 下載圖片
            const handleDownload = async () => {
                if (!cardRef.current) return;
                try {
                    // 顯示加載狀態或提示（可選）
                    const canvas = await html2canvas(cardRef.current, {
                        useCORS: true, // 重要：允許跨域圖片
                        scale: 2,      // 提高解析度
                        backgroundColor: null,
                    });
                    const link = document.createElement('a');
                    link.download = `瑞光沙舟-美麗箋-${new Date().getTime()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error("Download failed:", err);
                    alert("圖片生成失敗，請嘗試手動截圖。");
                }
            };

            if (!currentQuote) return (
                <div className="flex h-screen items-center justify-center bg-[#f7f5f0] text-[#8c8680] font-serif tracking-widest">
                    <span className="animate-pulse">Loading Warmth...</span>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 selection:bg-[#d6cbb8] selection:text-[#5a5248]">
                    
                    {/* 頻道選擇器 */}
                    <div className="w-full max-w-[640px] mb-6 overflow-x-auto no-scrollbar">
                        <div className="flex gap-2 px-1 pb-1">
                            {categories.map(cat => (
                                <button
                                    key={cat.id}
                                    onClick={() => handleCategoryChange(cat.id)}
                                    className={`
                                        whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold tracking-wider transition-all duration-300 border
                                        ${selectedCategory === cat.id 
                                            ? 'bg-[#5a5248] text-[#f2f0eb] border-[#5a5248] shadow-md transform -translate-y-0.5' 
                                            : 'bg-white text-[#8c8680] border-[#e8e4da] hover:border-[#a8a29e] hover:text-[#5a5248]'}
                                    `}
                                >
                                    {cat.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* 卡片容器 (ref用於截圖) */}
                    <div ref={cardRef} className="w-full max-w-[640px] aspect-square bg-[#fdfbf7] shadow-[0_20px_50px_-12px_rgba(0,0,0,0.15)] rounded-sm overflow-hidden flex relative ring-1 ring-[#e8e4da]">
                        <div className="absolute inset-0 opacity-[0.03] pointer-events-none bg-noise"></div>

                        <div className="flex w-full h-full relative z-10">
                            {/* 左側圖 */}
                            <div className={`w-[35%] relative overflow-hidden border-r border-[#e8e4da] transition-opacity duration-700 ${isAnimating ? 'opacity-80' : 'opacity-100'}`}>
                                <div className="absolute inset-0 bg-cover bg-center transition-transform duration-[2000ms] hover:scale-105"
                                     style={{ backgroundImage: `url('${bgImage}')`, backgroundColor: '#e5e5e5', filter: 'grayscale(20%) sepia(10%) contrast(95%) brightness(105%)' }}></div>
                                <div className="absolute bottom-16 left-6 text-white/90 writing-vertical-rl font-serif-en tracking-widest text-xs opacity-80 hidden md:block" style={{textShadow: '0 2px 4px rgba(0,0,0,0.3)'}}>
                                    {/* 圖片上的來源顯示也同步更新 */}
                                    {currentQuote.source} ‧ {currentQuote.year === '瑞光沙舟' ? '瑞光沙舟' : currentQuote.year}
                                </div>
                            </div>

                            {/* 右側文 */}
                            <div className="w-[65%] p-5 md:p-8 flex flex-col relative justify-center">
                                <div className="absolute top-10 left-6 opacity-[0.08] text-[#8c8680] pointer-events-none"><Quote size={80} className="transform rotate-180" /></div>

                                <div className={`flex flex-col justify-center transition-all duration-500 ${isAnimating ? 'opacity-0 translate-y-2' : 'opacity-100 translate-y-0'} relative z-10`}>
                                    <h1 className="text-3xl md:text-4xl lg:text-5xl font-romantic font-extrabold text-[#1c1917] leading-[1.6] mb-3 tracking-wide text-justify">
                                        {currentQuote.text}
                                    </h1>
                                    {currentQuote.enText && (
                                        <p className="text-base md:text-lg font-serif-en text-[#57534e] leading-relaxed mb-6 italic font-bold tracking-wide opacity-90">
                                            {currentQuote.enText}
                                        </p>
                                    )}
                                    <div className={`relative pl-4 ${currentQuote.enText ? 'mb-4' : 'mb-6 md:mb-8'}`}>
                                        <div className="absolute left-0 top-1 bottom-1 w-[4px] bg-[#d6cbb8]"></div>
                                        <p className="font-note text-[#44403c] text-base md:text-lg leading-7 italic font-bold opacity-95">
                                            {currentQuote.note}
                                        </p>
                                    </div>
                                    <div className="text-right mt-1 border-t border-[#e8e4da] pt-4">
                                        <p className="font-romantic font-extrabold text-[#292524] text-lg md:text-xl tracking-widest mb-1">{currentQuote.character}</p>
                                        <p className="font-serif-en font-bold text-[#78716c] text-xs md:text-sm tracking-wider uppercase flex items-center justify-end gap-2">
                                            <span>《 {currentQuote.source} 》</span>
                                            
                                            {/* 針對瑞光沙舟的特別顯示邏輯：直立分隔線 + 品牌名 */}
                                            {currentQuote.year === '瑞光沙舟' ? (
                                                <span className="flex items-center text-[#a8a29e]">
                                                    <span className="mx-1 text-lg font-light">|</span>
                                                    <span className="font-romantic text-[#5a5248] tracking-widest">{currentQuote.year}</span>
                                                </span>
                                            ) : (
                                                <span>({currentQuote.year})</span>
                                            )}
                                        </p>
                                    </div>
                                </div>

                                <div className="absolute bottom-16 left-0 right-0 flex justify-center opacity-70">
                                    <p className="font-romantic font-bold text-[10px] md:text-xs text-[#a8a29e] tracking-[0.3em]">© 2025 瑞光沙舟心流所</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 操作區 */}
                    <div className="mt-8 flex gap-6 items-center opacity-90 hover:opacity-100 transition-opacity">
                        {/* 複製按鈕 */}
                        <button onClick={handleCopy} className="flex flex-col items-center gap-2 group text-[#57534e] hover:text-[#1c1917] transition-colors" title="複製文字">
                            <div className="p-3 rounded-full border-2 border-[#d6cbb8] bg-[#fdfbf7] shadow-sm group-hover:shadow-md transition-all group-hover:-translate-y-1">
                                {copySuccess ? <Check size={24} className="text-green-600 stroke-[3px]" /> : <Share2 size={24} className="stroke-[2.5px]" />}
                            </div>
                            <span className="text-sm font-romantic font-bold tracking-widest">{copySuccess ? '已複製' : '複製'}</span>
                        </button>

                        <div className="h-8 w-[2px] bg-[#d6cbb8]"></div>

                        {/* 下載按鈕 (新增) */}
                        <button onClick={handleDownload} className="flex flex-col items-center gap-2 group text-[#57534e] hover:text-[#1c1917] transition-colors" title="下載美圖">
                            <div className="p-3 rounded-full border-2 border-[#d6cbb8] bg-[#fdfbf7] shadow-sm group-hover:shadow-md transition-all group-hover:-translate-y-1">
                                <Download size={24} className="stroke-[2.5px]" />
                            </div>
                            <span className="text-sm font-romantic font-bold tracking-widest">下載</span>
                        </button>

                        <div className="h-8 w-[2px] bg-[#d6cbb8]"></div>

                        {/* 刷新按鈕 */}
                        <button onClick={getRandomQuote} className="flex flex-col items-center gap-2 group text-[#57534e] hover:text-[#1c1917] transition-colors" title="下一句">
                            <div className="p-3 rounded-full border-2 border-[#d6cbb8] bg-[#fdfbf7] shadow-sm group-hover:shadow-md transition-all group-hover:-translate-y-1">
                                <RefreshCw size={24} className={`stroke-[2.5px] transition-transform duration-700 ${isAnimating ? 'rotate-180' : ''}`} />
                            </div>
                            <span className="text-sm font-romantic font-bold tracking-widest">下一句</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
